---
title: 'Worksheet 3: Data Manipulation'
author: "Amanda Regan"
date: "2023-01-05"
output:
  html_document:
    df_print: paged
---
_Before you begin this worksheet this week, please reinstall `DigitalMethodsData` from GitHub by running: `devtools::install_github("regan008/DigitalMethodsData")` in your console._

R has powerful tools for manipulating data. The Tidyverse is a collection of packages for R that are designed for data science. This worksheet will focus on the tools provided by both dplyr and tidyr. 

**dplyr** is "a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges." The verbs included in this package are: 


* `select()`: picks variables based on their names.
* `mutate()`: adds new variables that are functions of existing variables.
* `filter()`: picks cases based on their values.
* `summarise()`: reduces multiple values down to a single summary.
* `arrange()`: changes the ordering of the rows.

All of these verbs play nicely and combine naturally with `group_by()` which allows you to perform any operation “by group”.

For this worksheet we'll work primarily with the gayguides data. If you don't already have dplyr and magrittr installed, do that now using `install.packages("dplyr")` and `install.packages("magrittr")` in your console. 
```{r}
library(DigitalMethodsData)
library(dplyr)
library(magrittr)
data("gayguides")
```

## Select
Lets start with `select()`. This function allows you to subset columns using their names and types. 
```{r}
gayguides %>% 
  select(title, Year)
```
Notice that this subsetted the data and returned only the title and year. However, it didn't modify the gayguides data or save it to a new variable because we didn't assign the result to anything. 

(@) Use `select()` to take the city and state from gayguides and add them to a dataframe called "locations". 
```{r}

```

(@) What did you do to save the data to a new data frame? Why? 

>

(@) Can you use `select()` to grab all the columns of gayguides EXCEPT for the city and state? Hint: You might want to read the documentation for this function. 
```{r}

```

## Filter
The filter function subsets a data frame and retains all the rows that satisfy your conditions. To be retained, the row must produce a value of TRUE for _all_ of the conditions you provide. 

```{r}
gayguides %>% filter(Year > 1980)
```

```{r}
gayguides %>% 
  filter(city == "Greenville")
```

(@) The above code grabs every location where the city is Greenville. However, there is more than one city named Greenville. Can you filter to retrieve Greenville, SC? 

```{r}

```

(@) How about every location between 1975 and 1980? 

```{r}

```


(@) Every city in Greenville, SC between 1975 and 1980? 

```{r}

```

(@) Can you find all locations in 1975 except for New York and San Francisco? 
```{r}

```

## Mutate
The `mutate()` function adds new variables and preserves existing one. This is useful when you want to create a new column based on other values. For example, in the `statepopulation` dataset, perhaps we want to find out how much the population increased between 1800 and 1900. We can do that by subtracting the population in 1900 from 1800. 

```{r}
data("statepopulations")
statepopulations %>% mutate(difference = X1900 - X1800) 
```

(@) In the Boston Women Voters dataset, every voter is given an age. Can you use their age to calculate each person's birth year? (Assume all this data was collected in 1920.)
```{r}

```

(@) Can you create a new column that combines the city and state columns in `gayguides` into a new column called location? It should list the city, state. (i.e. San Diego, CA)

```{r}

```

## Arrange
Arrange() orders the rows of a data frame by the values of selected columns. In other words it sorts a data frame by a variable. In the `gayguides` data, we can sort the data by year with the earliest year first. If we wanted the latest year first, we could do so by using the `desc()` function. 

```{r}
gayguides %>%
  arrange(Year)

gayguides %>%
  arrange(desc(Year))
```


(@) Using the statepopulation data, which state has the largest population in 1850? Write code that pulls only the relevant columns (state and 1850) and sorts it accordingly. 
```{r}

```

### Group_by() and Summarize()

Arrange is useful for finding the highest and lowest values, but it returns those values for the entire dataset. `group_by()`, in contrast, takes an existing tbl and converts it into a grouped tbl where operations are performed "by group". Lets look at what that means in practice: 
```{r}
mydata <- gayguides %>% 
            select(title, Year) %>%
            group_by(Year)
```
It doesn't appear that this did much. But if you hove over this new variable in your environment pane, you'll see that its now listed as a "grouped data frame." Compare that to gayguides which is listed as just a data frame. This means that now we can run calculations on this data and it'll perform them "by group". Thats where summarize comes in.

```{r}
gayguides %>% 
    select(title, Year) %>%
    group_by(Year) %>%
    summarize(count = n())
```
Summarize creates a new data from that has rows for each combination of grouping variables. So in this example, we asked group_by to create groups based on year and then in summarize we created a column called count and passed it the n() function which gives the current group size. What results, is a dataset that lists each year and how many locations that state has. 

(@) You try, use group_by and summarize to find the total number of locations in each state, each year.
```{r}

```

(@) Summarize can do more than just count rows. Can you use `summarize()` to find the average age for each occupation in the Boston Women Voters data?
```{r}

```

(@) In the gayguides data, on average how many locations did each city in South Carolina have between 1970 and 1975?
```{r}

```

(@) Filter the dataset for only the values in the southernstates list (created in the block below). Then tell me, how many locations were in all the southern states in 1975?
```{r}
southernstates <- c("AL", "AR", "FL", "GA", "KY", "LA", "MD", "MS", "NC", "SC", "TN", "TX", "VI", "WV")

```

### Joins()
At some point, you might have a situation where you want to join two tables together. For example, perhaps you have historical population data that you want to add to your dataset in order to look at the number of locations by population size. A join will allow you to combine two datasets and create a new column that contains that data. 


spread()
gather()
